<?xml version="1.0" encoding="UTF-8"?>
<script xmlns="http://www.xstep.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <variables>
        <variable type="execution-file" name="execute"
            >file:///C:/Users/bruening.FDH-FFM/txstep/ueb/txstep.tu</variable>
        <char-group name="bt">?{-}\]</char-group>
        <variable type="permanent-file" name="niiimp" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/niiimp.tf</variable>
        <variable type="permanent-file" name="niiimp-full" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/niiimp-full.tf</variable>
        <variable type="permanent-file" name="niiimp-full2" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/nii2.tf</variable>
        <variable type="permanent-file" name="head" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/head.tf</variable>
        <variable type="permanent-file" name="intro" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/intro.tf</variable>
        <variable type="permanent-file" name="typ1" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/typ1.tf</variable>
        <variable type="permanent-file" name="typ2a" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/typ2a.tf</variable>
        <variable type="permanent-file" name="typ2b" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/typ2b.tf</variable>
        <variable type="permanent-file" name="typ4" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/typ4.tf</variable>
        <variable type="permanent-file" name="trail" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/trail.tf</variable>
        <variable type="permanent-file" name="sort" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/sort.tf</variable>
        <variable type="permanent-file" name="clean" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/clean.tf</variable>
        <variable type="permanent-file" name="sort-rtf" option="erase" format="system"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/sort.rtf</variable>
        <variable type="permanent-file" name="niiread" option="erase" format="system"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/niiread.rtf</variable>
        <variable type="permanent-file" format="tustep" option="erase" name="xxtable"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/xxtable.tf</variable>
        <!--        <variable type="permanent-file" code="UTF-8" name="xxtable-x" option="erase"
            >file:///C:/Users/bruening.FDH-FFM/faustedition/xml/xxtable.xml</variable>
-->
        <variable type="permanent-file" format="tustep" option="erase" name="xxtable-x"
            >file:///C:/Users/bruening.FDH-FFM/txstep/txt/xxtable-x.tf</variable>
    </variables>
    <tustep>
#de,da=*
rtf = C:\users\bruening.FDH-FFM\txstep\txt\nii.rtf
rtf-samp = C:\users\bruening.FDH-FFM\txstep\txt\nii-sample.rtf
rtf-sour = C:\users\bruening.FDH-FFM\txstep\txt\nii-source.rtf
*eof
#anmelde, rtf, traeger = -
#anmelde, rtf-samp, traeger = -
#anmelde, rtf-sour, traeger = -
#*import, rtf-sour, niiimp, ignor = +
#*import, rtf, niiimp-full, ignor = -
    </tustep>
    <transform source="$niiimp-full" destination="$niiimp-full2">
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>}}{[}*((</search-string>
                            <replacement-string/>
                        </string-pair>
                        <string-pair>
                            <search-string>))</search-string>
                            <replacement-string/>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
    </transform>
    <transform source="niiimp-full" destination="head">
        <define-text-units>
            <text-unit-start>
                <comparison-table>
                    <comparison-string>{{document</comparison-string>
                    <comparison-string>{{p </comparison-string>
                    <comparison-string>{{/section}}</comparison-string>
                    <comparison-string>{{/body}}</comparison-string>
                    <comparison-string>{{/document}}</comparison-string>
                </comparison-table>
            </text-unit-start>
        </define-text-units>
        <pass>
            <examine-text>
                <select>
                    <text-contains>
                        <search-table>
                            <search-string>{{document</search-string>
                        </search-table>
                    </text-contains>
                </select>
            </examine-text>
        </pass>
    </transform>
    <transform source="niiimp-full" destination="intro">
        <define-text-units>
            <text-unit-start>
                <comparison-table>
                    <exclusion-string>{{br/}}</exclusion-string>
                    <comparison-string>{{</comparison-string>
                </comparison-table>
            </text-unit-start>
        </define-text-units>
        <pass>
            <examine-text>
                <select>
                    <text-contains>
                        <search-table>
                            <search-string>font size="14"</search-string>
                            <search-string>Die Kategorisierungen</search-string>
                        </search-table>
                    </text-contains>
                </select>
            </examine-text>
        </pass>
        <insert-at-end>{{p after="0" line-feed="12"/}}</insert-at-end>
    </transform>
    <transform source="niiimp-full" destination="typ1">
        <insert-at-start>{{p after="0" line-feed="12"}}{{font size="12"}}Entscheidungen des Typs 1: Korrekturen eindeutiger (sprachlich sinnloser) Fehler {{/font}}{{/p}}</insert-at-start>
        <pass>
            <examine-text>
                <select>
                    <text-contains>
                        <search-table>
                            <exception-string>Ohne Eingriff{{/b}}{{/p}}</exception-string>
                            <exception-string>Noch zu entscheiden{{/b}}{{/p}}</exception-string>
                            <search-string>{{/b}}{{/p}}</search-string>
                            <search-string>\[Typ 1\]</search-string>
                        </search-table>
                    </text-contains>
                </select>
            </examine-text>
        </pass>
        <insert-at-end>{{p after="0" line-feed="12"/}}</insert-at-end>
    </transform>
    <transform source="niiimp-full" destination="typ2a">
        <insert-at-start>{{p after="0" line-feed="12"}}{{font size="12"}}Entscheidungen des Typs 2a: Emendationen von Überlieferungsfehlern: Schreib- oder Setzerfehler gegen die unmittelbare Vorlage{{/font}}{{/p}}</insert-at-start>
        <pass>
            <examine-text>
                <select>
                    <text-contains>
                        <search-table>
                            <exception-string>Ohne Eingriff{{/b}}{{/p}}</exception-string>
                            <exception-string>Noch zu entscheiden{{/b}}{{/p}}</exception-string>
                            <search-string>{{/b}}{{/p}}</search-string>
                            <search-string>\[Typ 2a\]</search-string>
                        </search-table>
                    </text-contains>
                </select>
            </examine-text>
        </pass>
        <insert-at-end>{{p after="0" line-feed="12"/}}</insert-at-end>
    </transform>
    <transform source="niiimp-full" destination="typ2b">
        <insert-at-start>{{p after="0" line-feed="12"}}{{font size="12"}}Entscheidungen des Typs 2b: Emendationen von Überlieferungsfehlern: aus der unmittelbaren Vorlage geerbte Fehler{{/font}}{{/p}}</insert-at-start>
        <pass>
            <examine-text>
                <select>
                    <text-contains>
                        <search-table>
                            <exception-string>Ohne Eingriff{{/b}}{{/p}}</exception-string>
                            <exception-string>Noch zu entscheiden{{/b}}{{/p}}</exception-string>
                            <search-string>{{/b}}{{/p}}</search-string>
                            <search-string>\[Typ 2b\]</search-string>
                        </search-table>
                    </text-contains>
                </select>
            </examine-text>
        </pass>
        <insert-at-end>{{p after="0" line-feed="12"/}}</insert-at-end>
    </transform>
    <transform source="niiimp-full" destination="typ4">
        <insert-at-start>{{p after="0" line-feed="12"}}{{font size="12"}}Entscheidungen des Typs 4: Wiederherstellung oder Ausschließung von übergangenen Autorvarianten{{/font}}{{/p}}</insert-at-start>
        <pass>
            <examine-text>
                <select>
                    <text-contains>
                        <search-table>
                            <exception-string>Ohne Eingriff{{/b}}{{/p}}</exception-string>
                            <exception-string>Noch zu entscheiden{{/b}}{{/p}}</exception-string>
                            <search-string>{{/b}}{{/p}}</search-string>
                            <search-string>\[Typ 4</search-string>
                        </search-table>
                    </text-contains>
                </select>
            </examine-text>
        </pass>
        <insert-at-end>{{p after="0" line-feed="12"/}}</insert-at-end>
    </transform>
    <transform source="niiimp-full" destination="trail">
        <pass>
            <examine-text>
                <select>
                    <text-contains>
                        <search-table>
                            <search-string>{{/section}}</search-string>
                            <search-string>{{/body}}</search-string>
                            <search-string>{{/document}}</search-string>
                        </search-table>
                    </text-contains>
                </select>
            </examine-text>
        </pass>
    </transform>
    <!-- collect head, ..., and trailing section -->
    <transform source="head" destination="sort"/>
    <transform source="intro" destination="sort" option="append"/>
    <transform source="typ1" destination="sort" option="append"/>
    <transform source="typ2a" destination="sort" option="append"/>
    <transform source="typ2b" destination="sort" option="append"/>
    <transform source="typ4" destination="sort" option="append"/>
    <transform source="trail" destination="sort" option="append"/>
    <transform source="sort" destination="clean">
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>}}{[}*((</search-string>
                            <replacement-string/>
                        </string-pair>
                        <string-pair>
                            <search-string>))</search-string>
                            <replacement-string/>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>Calibri</search-string>
                            <replacement-string>Times</replacement-string>
                        </string-pair>
                        <string-pair>
                            <search-string>\[Typ*\]</search-string>
                            <replacement-string/>
                        </string-pair>
                        <string-pair>
                            <search-string>before^_</search-string>
                            <replacement-string>vor </replacement-string>
                        </string-pair>
                        <string-pair>
                            <search-string>after^_</search-string>
                            <replacement-string>nach </replacement-string>
                        </string-pair>
                        <string-pair>
                            <search-string>2^_I^_H.0a</search-string>
                            <replacement-string>I H{{sup}}0a{{/sup}}</replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
    </transform>
    <tustep>
#*export, clean, sort-rtf, loeschen = +        
#*export, niiimp-full2, niiread, loeschen = +        
    </tustep>
    <transform source="niiimp" destination="xxtable">
        <insert-at-start>{{exchange-table}}</insert-at-start>
        <exchange-on-input>
            <exchange-table>
                <string-pair>
                    <search-string>{{document source=*</search-string>
                    <replacement-string/>
                </string-pair>
                <string-pair>
                    <search-string>{{/document}}</search-string>
                    <replacement-string/>
                </string-pair>
                <string-pair>
                    <search-string>{{{0}/body}}</search-string>
                    <replacement-string/>
                </string-pair>
                <string-pair>
                    <search-string>{{{0}/section*</search-string>
                    <replacement-string/>
                </string-pair>
            </exchange-table>
        </exchange-on-input>
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>{[}{{p}}::{|}*{|}::{|}*{|}||</search-string>
                            <replacement-string>{{sp}}{{ss}}"{=2=}"\*\{|\}{=4=}{{/ss}}</replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>{{/ss}}{[}id={|}*{|}::{|}*{|}((*(Typ {|}*{|}){{/i}}))*</search-string>
                            <replacement-string>{{rs}}\{=1=\}\{\{seg+xml:id="{=2=}"\}\}{=4=}\{\{/seg\}\}\{\{note+target="^#{=2=}"+type="textcrit"+subtype="{=6=}"\}\}{=5=}{=6=}{=7=}{{/rs}}{{/sp}}</replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>(({{i}}{|}*{|}{{/i}} {|}*{|} {{i}}\[\[{|}*{|}\]\]{{/i}}\]</search-string>
                            <replacement-string>\{\{app+loc="{=2=}"\}\} \{\{lem+wit="{=6=}"\}\}{=4=}\{\{/lem\}\}</replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>\{\{/lem\}\} {|}*{|} {{i}}\[\[{|}*{|}\]\]*)){{/p}}</search-string>
                            <replacement-string>{=1=}\{\{rdg+wit="{=4=}"\}\}{=2=}\{\{/rdg\}\} \{\{/app\}\}\{\{/note\}\}</replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
        <new-line-before>
            <search-table>
                <search-string>{{sp}}</search-string>
                <search-string>{{ss}}</search-string>
                <search-string>{{rs}}</search-string>
                <search-string>\{\{{0}/note</search-string>
                <search-string>\{\{app</search-string>
                <search-string>\{\{rdg</search-string>
                <search-string>{{/sp}}</search-string>
            </search-table>
        </new-line-before>
        <suppress-blank-lines/>
        <insert-at-end>{{/exchange-table}}</insert-at-end>
    </transform>
    <transform source="xxtable" destination="xxtable-x">
        <define-text-units>
            <text-unit-start>
                <comparison-table>
                    <exclusion-string>\{\{note</exclusion-string>
                    <exclusion-string>\{\{app</exclusion-string>
                    <exclusion-string>\{\{rdg</exclusion-string>
                    <comparison-string>{{sp}}</comparison-string>
                    <comparison-string>{{/sp}}</comparison-string>
                </comparison-table>
            </text-unit-start>
        </define-text-units>
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>{{{0}/{[}sp{]}}}</search-string>
                            <replacement-string>string-pair</replacement-string>
                        </string-pair>
                        <string-pair>
                            <search-string>{{{0}/{[}ss{]}}}</search-string>
                            <replacement-string>search-string</replacement-string>
                        </string-pair>
                        <string-pair>
                            <search-string>{{{0}/{[}rs{]}}}</search-string>
                            <replacement-string>replacement-string</replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
        <new-line-before>
            <search-table>
                <search-string>{{search</search-string>
                <search-string>{{replacement</search-string>
            </search-table>
        </new-line-before>
    </transform>
</script>
