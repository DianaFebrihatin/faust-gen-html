<?xml version="1.0" encoding="UTF-8"?>
<script xmlns="http://www.xstep.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <variables>
        <char-group name="tg">?{-}{{}}%</char-group>
        <variable type="execution-file" name="execute"
            >file:///C:/Users/gerri/txstep/ueb/txstep.tu</variable>
        <variable type="permanent-file" code="UTF-8" name="h-x"
            >file:///C:/Users/gerri/faustedition/xml/h.xml</variable>
        <variable type="permanent-file" format="tustep" option="erase" name="z1"
            >file:///C:/Users/gerri/txstep/txt/z1.tf</variable>
        <variable type="permanent-file" code="UTF-8" name="kt-x" option="erase"
            >file:///C:/Users/gerri/faustedition/xml/kt.xml</variable>
        <variable type="scratch-file" name="ko1"/>
    </variables>
    <transform source="$h-x" destination="$z1" save-params="ko1">
        <define-text-units>
            <text-unit-start>
                <comparison-table>
                    <exclusion-string>{{/</exclusion-string>
                    <comparison-string>{{</comparison-string>
                </comparison-table>
            </text-unit-start>
        </define-text-units>
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>*{{\T\E\I*</search-string>
                            <replacement-string/>
                        </string-pair>
                        <string-pair>
                            <search-string>{{/TEI}}</search-string>
                            <replacement-string/>
                        </string-pair>
                        <!-- tags into tokens: -->
                        <string-pair>
                            <search-string>{1-0} }}</search-string>
                            <replacement-string>}}</replacement-string>
                        </string-pair>
                        <string-pair>
                            <search-string>{{{00}{c:tg}{[} {]}{00}{c:tg}}}</search-string>
                            <replacement-string>+</replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
    </transform>
    <!-- tokens back into tags -->
    <transform source="$z1" destination="$kt-x">
        <pass>
            <modify>
                <exchange>
                    <exchange-table>
                        <string-pair>
                            <search-string>{{{00}{c:tg}{[}+{]}{00}{c:tg}}}</search-string>
                            <replacement-string> </replacement-string>
                        </string-pair>
                    </exchange-table>
                </exchange>
            </modify>
        </pass>
    </transform>
</script>
